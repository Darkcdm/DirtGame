<head>
	<title>REGISTRATION</title>
	<style>
		.center {
			display: flex;
			justify-content: center;
			align-items: center;
			height: 200px;
		}
	</style>
</head>

<body onload="checkLoggin()">
	<h1>Registration</h1>
	<div>
		<form>
			<label>Username: </label><br />
			<input type="username" id="username" /><br /><br />
			<label>Email: </label><br />
			<input type="email" id="email" /><br /><br />
			<label>Password: </label><br />
			<input type="password" id="password" /><br /><br />
			<label>Password again: </label><br />
			<input type="password" id="passwordCheck" /><br /><br />
		</form>
		<button onclick="registration()">REGISTRATION</button>
		<p id="TEST"></p>
	</div>
	<div>
		<a href="WelcomePage.html">Back to Main Menu</a>
	</div>
</body>

<script>
	function registration() {
		//get data from the form
		const username = document.getElementById("username").value;
		const email = document.getElementById("email").value;
		const password = document.getElementById("password").value;
		const passwordCheck = document.getElementById("passwordCheck").value;

		//DEBUG
		console.log(username);
		console.log(email);
		console.log(password);
		console.log(passwordCheck);

		//check that all the inputs are set
		if (username == "") {
			document.getElementById("TEST").innerHTML =
				"You forgot to enter username";
			return;
		}
		if (email == "") {
			document.getElementById("TEST").innerHTML = "You forgot to enter email";
			return;
		}
		if (password == "") {
			document.getElementById("TEST").innerHTML =
				"You forgot to enter password";
			return;
		}
		if (passwordCheck == "") {
			document.getElementById("TEST").innerHTML =
				"You forgot to enter password to check";
			return;
		}

		//send userdata to server to check if the user exists
		var xmlhttp = new XMLHttpRequest();
		xmlhttp.onreadystatechange = function () {
			if (this.readyState == 4 && this.status == 200) {
				if (!Number.isNaN(this.responseText)) {
					sessionStorage.setItem("UserID", this.responseText);
					window.location.replace("GameScreen.html");
				}

				switch (this.responseText) {
					case "username":
						document.getElementById("TEST").innerHTML =
							"Something is wrong with your username";
						break;
					case "email":
						document.getElementById("TEST").innerHTML =
							"This email is already in use";
						break;
					case "password":
						document.getElementById("TEST").innerHTML =
							"Password fields do not match";
						break;
					default:
						document.getElementById("TEST").innerHTML = this.responseText;
				}
			}
		};

		xmlhttp.open("POST", "action/registration.php", true);
		xmlhttp.setRequestHeader(
			"Content-type",
			"application/x-www-form-urlencoded"
		);
		xmlhttp.send(
			"username=" +
				username +
				"&email=" +
				email +
				"&password=" +
				password +
				"&passwordCheck=" +
				passwordCheck
		);
	}

	function checkLoggin() {
		if (sessionStorage.getItem("UserID")) {
			window.location.replace("GameScreen.html");
		}
	}
</script>
